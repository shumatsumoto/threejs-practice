## 1. 問題タイトル

15 本目：テクスチャの読み込み

## 2. 学習目標

この演習を通じて、以下の技術を習得します。

- `TextureLoader` を使用した画像の読み込み
- `map` プロパティへのテクスチャ適用
- 非同期処理（画像のロード待ち）の概念

## 3. 新しい概念の解説

**Texture（テクスチャ）**
3D オブジェクトの表面に貼り付ける「画像」のことです。
木目や金属、レンガなどの質感を表現するために使われます。

**TextureLoader**
画像を読み込むためのローダーです。
`load()` メソッドは非同期（バックグラウンド）で画像を読み込みます。読み込み完了前に次の行が実行されますが、Three.js は読み込み完了時に自動的に再描画してくれます。

```javascript
const loader = new THREE.TextureLoader();
// 画像をロードしてテクスチャとして取得
const texture = loader.load('path/to/image.jpg');

// マテリアルの map プロパティに適用
const material = new THREE.MeshBasicMaterial({ map: texture });
```

## 4. 課題の説明

画像ファイルを読み込んで、平面（PlaneGeometry）に貼り付けて表示してください。
これにより、単色ではなく写真やイラストを表示できるようになります。
※練習用に、ネット上のフリー素材 URL（例: `https://threejs.org/examples/textures/crate.gif`）などを使用してください。

## 5. 必須要件

以下の機能を実装してください。

- **TextureLoaderの作成**:
  `const loader = new THREE.TextureLoader()` をインスタンス化します。

- **画像の読み込み**:
  `loader.load(url)` を使用して画像を読み込みます（Three.js公式サンプル画像など）。

- **マテリアルへの適用**:
  `MeshBasicMaterial`（または Standard）を作成し、`map` プロパティに読み込んだテクスチャを設定します。

- **表示**:
  そのマテリアルを使って `PlaneGeometry` を作成し、シーンに表示します。画像が表示されていることを確認してください。

## 6. ヒント

- **ヒント 1（非同期ロード）**:
  `loader.load()` は画像のダウンロード完了を待ちません（非同期）。
  返り値の `texture` オブジェクトは最初は空ですが、ダウンロード完了後に自動的に画像データが入ります。
- **ヒント 2（CORSエラー）**:
  外部サイトの画像を読み込む際、セキュリティ制限（CORS）でエラーになることがあります。
  Three.js 公式の素材や、Imgur などの許可されたホスト、またはローカルサーバー上の画像を使う必要があります。
- **ヒント 3（マテリアルの色）**:
  `map` を設定しても `color` プロパティは有効です。
  `color: 0xff0000`（赤）にすると、画像全体が赤っぽく着色されます。元の色を出したい場合は `color` を指定しない（デフォルトの白）か、明示的に `0xffffff` にします。
- **ヒント 4（アスペクト比）**:
  正方形の PlaneGeometry に長方形の画像を貼ると、画像が押しつぶされます。
  画像の縦横比に合わせてジオメトリのサイズ（幅・高さ）を調整すると綺麗に見えます。
- **ヒント 5（キャッシュ）**:
  一度読み込んだテクスチャはメモリに残ります。同じ画像を複数のメッシュで使い回すときは、何度も load せず、変数に入れた texture を再利用しましょう。

## 7. スターターコード

```javascript
import * as THREE from "three";

const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(
  75,
  window.innerWidth / window.innerHeight,
  0.1,
  1000
);
const renderer = new THREE.WebGLRenderer();
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

// --- ここでテクスチャを読み込んでください ---
// 画像URL例: 'https://threejs.org/examples/textures/crate.gif'

// --- ここで平面を作成し、テクスチャを貼り付けてください ---

camera.position.z = 5;

function animate() {
  requestAnimationFrame(animate);
  renderer.render(scene, camera);
}
animate();
```

## 8. 模範解答

```javascript
import * as THREE from "three";

const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(
  75,
  window.innerWidth / window.innerHeight,
  0.1,
  1000
);
const renderer = new THREE.WebGLRenderer();
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

// 1. TextureLoaderの作成
const loader = new THREE.TextureLoader();

// 2. 画像の読み込み
// 戻り値としてテクスチャオブジェクトが即座に返されます（中身はロード後に更新）
const texture = loader.load("https://threejs.org/examples/textures/crate.gif");

// 3. マテリアルへの適用
// mapプロパティにテクスチャを指定します
const geometry = new THREE.PlaneGeometry(2, 2);
const material = new THREE.MeshBasicMaterial({ map: texture });
const plane = new THREE.Mesh(geometry, material);
scene.add(plane);

camera.position.z = 5;

function animate() {
  requestAnimationFrame(animate);
  renderer.render(scene, camera);
}
animate();
```
