## 1. 問題タイトル

32 本目：バンプマップの適用

## 2. 学習目標

この演習を通じて、以下の技術を習得します。

- `bumpMap` プロパティによる凹凸表現
- テクスチャによるディテールの追加
- ポリゴン数を増やさずに質感を高める手法

## 3. 新しい概念の解説

**Bump Mapping（バンプマッピング）**
画像の白黒（濃淡）情報を使って、擬似的に表面の凹凸を表現する技術です。
実際にポリゴンを変形させるわけではなく、光の反射計算を工夫することで、低いコストで細かなディテールを追加できます。
白い部分が高く、黒い部分が低く見えます。

```javascript
const texture = loader.load('bump.jpg');
const material = new THREE.MeshStandardMaterial({
  bumpMap: texture,
  bumpScale: 1.0 // 凹凸の深さ
});
```

## 4. 課題の説明

平面に「バンプマップ（凹凸情報を持つ白黒画像）」を適用し、表面がザラザラしているように見せてください。
実際には平面のままですが、光の反射計算を変えることで凹凸があるように錯覚させます。

## 5. 必須要件

以下の機能を実装してください。

- **テクスチャ読み込み**:
  `TextureLoader` でバンプマップ用の白黒画像を読み込みます（例：岩肌やノイズ画像）。

- **マテリアル設定**:
  `MeshStandardMaterial` を使用し、`bumpMap` プロパティにテクスチャを設定します。
  `map`（カラーマップ）は設定しなくても構いません（効果を分かりやすくするため）。

- **バンプスケールの調整**:
  `material.bumpScale` の値を設定し、凹凸の深さを調整します。
  最初は強め（例：0.5〜1.0）にして効果を確認してください。

- **照明の調整**:
  `DirectionalLight` や `PointLight` を適切な位置に配置し、影によって凹凸が強調されるようにします。

## 6. ヒント

- **ヒント 1（効果の仕組み）**:
  ジオメトリ（頂点）そのものを変形させるのではなく、光の反射計算を騙すことで凹凸があるように見せる技術です。
  そのため、シルエット（輪郭）は直線のまま変わりません。
- **ヒント 2（画像の明暗）**:
  テクスチャの「白い部分」が高く見え、「黒い部分」が低く見えます。
  専用のバンプマップ画像がない場合、コントラストの強い普通の画像でも代用できます。
- **ヒント 3（強さの調整）**:
  `material.bumpScale` プロパティで凹凸の深さを調整できます。
  値が大きいほど堀が深く見えます。
- **ヒント 4（ライト必須）**:
  光の影を利用して凹凸を表現するため、`DirectionalLight` や `PointLight` などの「影ができるライト」がないと効果が全く分かりません。
- **ヒント 5（カラーマップとの併用）**:
  通常は `map`（色）と `bumpMap`（凹凸）の両方に同じ（または対応する）テクスチャを設定して、リアルな物体を作ります。
  今回はバンプマップの効果を確認するため `map` は設定しなくても OK です。

## 7. スターターコード

```javascript
import * as THREE from "three";

const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(
  75,
  window.innerWidth / window.innerHeight,
  0.1,
  1000
);
const renderer = new THREE.WebGLRenderer();
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

const loader = new THREE.TextureLoader();
// 適当なノイズ画像などを読み込む
const bumpTexture = loader.load(
  "https://threejs.org/examples/textures/planets/earth_normal_2048.jpg"
); // 代用

// --- ここでバンプマップを適用したマテリアルを作成 ---

const light = new THREE.DirectionalLight(0xffffff, 1);
light.position.set(1, 1, 1);
scene.add(light);

camera.position.z = 5;

function animate() {
  requestAnimationFrame(animate);
  renderer.render(scene, camera);
}
animate();
```

## 8. 模範解答

```javascript
import * as THREE from "three";

const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(
  75,
  window.innerWidth / window.innerHeight,
  0.1,
  1000
);
const renderer = new THREE.WebGLRenderer();
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

const loader = new THREE.TextureLoader();
// 石壁のバンプマップ例
const bumpTexture = loader.load(
  "https://threejs.org/examples/textures/brick_bump.jpg"
);

const geometry = new THREE.BoxGeometry(2, 2, 2);
const material = new THREE.MeshStandardMaterial({
  color: 0xaaaaaa,
  bumpMap: bumpTexture, // バンプマップ設定
  bumpScale: 4, // 凹凸の深さ（かなり強調）
});

const cube = new THREE.Mesh(geometry, material);
scene.add(cube);

// ライトがないと凹凸が見えない
// 横から光を当てると凹凸が際立つ
const light = new THREE.DirectionalLight(0xffffff, 1.5);
light.position.set(1, 1, 1);
scene.add(light);

camera.position.z = 5;

function animate() {
  requestAnimationFrame(animate);

  cube.rotation.x += 0.005;
  cube.rotation.y += 0.005;

  renderer.render(scene, camera);
}
animate();
```
