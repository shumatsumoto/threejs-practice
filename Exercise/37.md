## 1. 問題タイトル

37 本目：地面の作成

## 2. 学習目標

この演習を通じて、以下の技術を習得します。

- `PlaneGeometry` の回転と配置
- テクスチャの繰り返し（Repeat）設定
- 広大なフィールドの表現

## 3. 新しい概念の解説

**Texture Wrap & Repeat（テクスチャの繰り返し）**
通常、テクスチャは 1 枚の絵として引き伸ばされますが、壁紙や地面のように「同じ絵を繰り返し並べたい」場合があります。
- `wrapS`, `wrapT`: 繰り返しの設定（`RepeatWrapping` で有効化）
- `repeat`: 繰り返す回数（例: 10 回）
これを使うと、解像度の低い画像でも広大な地面を綺麗に表現できます。

```javascript
const texture = loader.load('grass.jpg');

// 繰り返しの設定（縦横）
texture.wrapS = THREE.RepeatWrapping;
texture.wrapT = THREE.RepeatWrapping;

// 10回繰り返す
texture.repeat.set(10, 10);

const material = new THREE.MeshBasicMaterial({ map: texture });
```

## 4. 課題の説明

キャラクターや建物が立つための「地面」を作成してください。
単なる色付きの板ではなく、芝生や土のテクスチャを貼り付け、それが自然に見えるように「繰り返し（タイリング）」設定を行います。

## 5. 必須要件

以下の機能を実装してください。

- **テクスチャの設定**:
  `TextureLoader` で地面用画像（芝生やタイルなど）を読み込みます。
  `texture.wrapS = THREE.RepeatWrapping;`
  `texture.wrapT = THREE.RepeatWrapping;`
  を設定し、繰り返しの準備をします。

- **繰り返しの指定**:
  `texture.repeat.set(10, 10)` など、ジオメトリのサイズに合わせて適当な回数を指定します。

- **地面の作成**:
  大きな `PlaneGeometry`（100x100など）を作成し、上記テクスチャを貼ったマテリアルを適用します。
  `rotation.x = -Math.PI / 2` で水平に倒し、シーンに追加します。

- **確認**:
  テクスチャが引き伸ばされずに、タイル状に綺麗に並んで表示されていることを確認します。

## 6. ヒント

- **ヒント 1（繰り返しモードの設定）**:
  テクスチャを読み込んだ直後に以下を設定します。これは必須です。
  `texture.wrapS = THREE.RepeatWrapping;`（横方向）
  `texture.wrapT = THREE.RepeatWrapping;`（縦方向）
- **ヒント 2（繰り返し回数）**:
  `texture.repeat.set(10, 10);`
  これでテクスチャが 10x10 のタイル状に並びます。数字が大きいほど細かくなります。
- **ヒント 3（平面の向き）**:
  `PlaneGeometry` はデフォルトで立っています（Z 軸向き）。
  地面にするには `rotation.x = -Math.PI / 2` で 90 度倒して寝かせる必要があります。
- **ヒント 4（サイズ）**:
  ジオメトリ自体も `PlaneGeometry(100, 100)` のように大きく作らないと、広大な地面になりません。
- **ヒント 5（裏面）**:
  地面の下から見上げることはあまりないですが、もし裏側が見えてしまう場合は `side: THREE.DoubleSide` を設定することも検討します（通常は不要）。

## 7. スターターコード

```javascript
import * as THREE from "three";

const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(
  75,
  window.innerWidth / window.innerHeight,
  0.1,
  1000
);
const renderer = new THREE.WebGLRenderer();
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

const loader = new THREE.TextureLoader();
const texture = loader.load(
  "https://threejs.org/examples/textures/terrain/grasslight-big.jpg"
);

// --- ここでテクスチャの繰り返し設定 ---

// --- ここで地面を作成 ---

camera.position.set(0, 2, 5);

function animate() {
  requestAnimationFrame(animate);
  renderer.render(scene, camera);
}
animate();
```

## 8. 模範解答

```javascript
import * as THREE from "three";

const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(
  75,
  window.innerWidth / window.innerHeight,
  0.1,
  1000
);
const renderer = new THREE.WebGLRenderer();
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

const loader = new THREE.TextureLoader();
const texture = loader.load(
  "https://threejs.org/examples/textures/terrain/grasslight-big.jpg"
);

// 1. テクスチャの繰り返し設定
texture.wrapS = THREE.RepeatWrapping; // 横方向の繰り返し
texture.wrapT = THREE.RepeatWrapping; // 縦方向の繰り返し
texture.repeat.set(10, 10); // 10回繰り返す

// 2. 地面の作成
const geometry = new THREE.PlaneGeometry(100, 100);
const material = new THREE.MeshBasicMaterial({ map: texture });
const ground = new THREE.Mesh(geometry, material);

// 水平にする
ground.rotation.x = -Math.PI / 2;
scene.add(ground);

camera.position.set(0, 5, 10);
camera.lookAt(0, 0, 0);

function animate() {
  requestAnimationFrame(animate);
  renderer.render(scene, camera);
}
animate();
```
