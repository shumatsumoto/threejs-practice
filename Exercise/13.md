## 1. 問題タイトル

13 本目：ライトの追加（SpotLight）

## 2. 学習目標

この演習を通じて、以下の技術を習得します。

- `SpotLight`（スポットライト）の特性とパラメータ
- ライトのターゲット（向き）の制御
- `SpotLightHelper` を使った照射範囲の可視化

## 3. 新しい概念の解説

**SpotLight（スポットライト）**
特定の位置から一方向に向かって、円錐状に広がる光です。
懐中電灯や舞台照明のような表現に適しています。
- `angle`: 光の広がり具合
- `penumbra`: 光の縁のボケ具合
- `target`: 光が向く先（デフォルトは原点）

```javascript
const spotLight = new THREE.SpotLight(0xffffff, 1.0);
spotLight.angle = Math.PI / 4; // 広がり角度
scene.add(spotLight);
```

**Helper（ヘルパー）**
開発中に「ライトがどこにあるか」「カメラがどこを向いているか」などを可視化する補助ツールです。
`SpotLightHelper` を使うと、光の範囲を線で表示してくれます。

```javascript
// ライトの範囲を可視化するヘルパー
const helper = new THREE.SpotLightHelper(spotLight);
scene.add(helper);
```

## 4. 課題の説明

懐中電灯や舞台照明のように、円錐状に光を照射する「スポットライト（SpotLight）」を追加してください。
照射角度やボケ具合（penumbra）を調整して、劇的なライティングを作ります。

## 5. 必須要件

以下の機能を実装してください。

- **SpotLightの作成**:
  `DirectionalLight` を削除（またはコメントアウト）し、代わりに `THREE.SpotLight` を作成します。
  色：白、強さ：10以上（距離による減衰があるため強めに）。

- **パラメータ設定**:
  位置を `(0, 5, 0)`（真上）に設定します。
  `angle`（照射角度）を `Math.PI / 6`（30度）に設定します。
  `penumbra`（ボケ具合）を `0.2` に設定します。

- **ヘルパーの追加**:
  `THREE.SpotLightHelper` を作成し、シーンに追加して光の形状を可視化します。
  ※ヘルパーを正しく表示するには、アニメーションループ内で `helper.update()` が必要な場合があります（バージョンによる）。今回は念のため入れておくと確実です。

## 6. ヒント

- **ヒント 1（円錐の形状）**:
  スポットライトは円錐状に光を出します。`angle` プロパティ（ラジアン）でその開き具合を調整できます。
  `Math.PI/6` なら 30 度、`Math.PI/3` なら 60 度の広がりになります。
- **ヒント 2（境界のぼかし）**:
  `penumbra`（ペナンブラ）を `0` から `1` の間で設定すると、光の縁がふわっとボケます。
  `0` だと舞台のピンスポットのようにくっきりし、`1` だと柔らかい懐中電灯のようになります。
- **ヒント 3（ターゲット制御）**:
  デフォルトでは原点 `(0,0,0)` を向きます。
  もし特定のオブジェクトを追尾させたい場合は、`light.target = mesh` のように設定します（ただし `light.target` もシーンに追加する必要があります）。
- **ヒント 4（Helperの活用）**:
  `SpotLightHelper` を使うと、光がどこからどこへ向かっているか一目瞭然になります。
  ライトの位置や角度を調整する際は必須のツールです。
- **ヒント 5（減衰）**:
  物理的に正しいライト（Physically Correct Lights）の設定にすると、光は距離とともに弱くなります（減衰）。
  デフォルト設定ではあまり減衰しませんが、`distance` パラメータで届く距離を制限することも可能です。

## 7. スターターコード

```javascript
import * as THREE from "three";

const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(
  75,
  window.innerWidth / window.innerHeight,
  0.1,
  1000
);
const renderer = new THREE.WebGLRenderer();
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

const geometry = new THREE.BoxGeometry(1, 1, 1);
const material = new THREE.MeshStandardMaterial({ color: 0x00ff00 });
const cube = new THREE.Mesh(geometry, material);
scene.add(cube);

// 床（光の当たり方がわかりやすいように）
const plane = new THREE.Mesh(
  new THREE.PlaneGeometry(10, 10),
  new THREE.MeshStandardMaterial({ color: 0xaaaaaa })
);
plane.rotation.x = -Math.PI / 2;
plane.position.y = -1;
scene.add(plane);

camera.position.set(0, 2, 5);
camera.lookAt(0, 0, 0);

// --- ここでSpotLightとHelperを追加してください ---

// --- ここまで ---

function animate() {
  requestAnimationFrame(animate);
  cube.rotation.y += 0.01;
  renderer.render(scene, camera);
}
animate();
```

## 8. 模範解答

```javascript
import * as THREE from "three";

const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(
  75,
  window.innerWidth / window.innerHeight,
  0.1,
  1000
);
const renderer = new THREE.WebGLRenderer();
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

const geometry = new THREE.BoxGeometry(1, 1, 1);
const material = new THREE.MeshStandardMaterial({ color: 0x00ff00 });
const cube = new THREE.Mesh(geometry, material);
scene.add(cube);

// 床
const plane = new THREE.Mesh(
  new THREE.PlaneGeometry(10, 10),
  new THREE.MeshStandardMaterial({ color: 0xaaaaaa })
);
plane.rotation.x = -Math.PI / 2;
plane.position.y = -1;
scene.add(plane);

camera.position.set(0, 2, 5);
camera.lookAt(0, 0, 0);

// 1. スポットライトの作成
const spotLight = new THREE.SpotLight(0xffffff, 10);
spotLight.position.set(0, 5, 0); // 真上から
spotLight.angle = Math.PI / 6; // 照射角度（狭め）
spotLight.penumbra = 0.2; // 縁を少しぼかす
scene.add(spotLight);

// 2. ヘルパーの追加
const spotLightHelper = new THREE.SpotLightHelper(spotLight);
scene.add(spotLightHelper);

// 環境光（補助）
const ambientLight = new THREE.AmbientLight(0xffffff, 0.2);
scene.add(ambientLight);

function animate() {
  requestAnimationFrame(animate);
  cube.rotation.y += 0.01;
  spotLightHelper.update(); // ライトが動く場合は必要
  renderer.render(scene, camera);
}
animate();
```
