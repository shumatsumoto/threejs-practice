## 1. 問題タイトル

10 本目：OrbitControls の追加

## 2. 学習目標

この演習を通じて、以下の技術を習得します。

- 外部モジュール（Addons）のインポートと使用
- カメラコントローラーによるインタラクティブ性の向上

## 3. 新しい概念の解説

**OrbitControls（オービットコントロール）**
マウス操作（ドラッグやホイール）でカメラをその名の通り「軌道（Orbit）」に乗って動かせるようにする拡張機能です。
Three.js 本体とは別のファイル（Addons）として提供されています。

**Importing Addons**
`three/examples/jsm/...` からインポートして使用します。
npm パッケージを使用している場合はパス解決が自動で行われますが、CDN などの場合はパスに注意が必要です。

```javascript
import { OrbitControls } from "three/examples/jsm/controls/OrbitControls";

// カメラとレンダラーのDOM要素を渡して作成
const controls = new OrbitControls(camera, renderer.domElement);

// 滑らかな減衰（ダンピング）を有効にする場合
controls.enableDamping = true;
// ダンピングを使う場合はanimation loop内でcontrols.update()が必要
```

## 4. 課題の説明

マウスを使ってカメラを自由に動かせるように、便利な拡張機能 `OrbitControls` を導入してください。

## 5. 必須要件

以下の機能を実装してください。

- **インポート**:
  `import { OrbitControls } from 'three/examples/jsm/controls/OrbitControls';` を記述します。

- **コントロール作成**:
  `const controls = new OrbitControls(camera, renderer.domElement);` を作成します。
  これにより、カメラがマウス操作と連動するようになります。

- **更新処理（オプション）**:
  ダンピング（慣性）を有効にする場合は `controls.enableDamping = true;` を設定し、`animate` ループ内で `controls.update();` を呼び出します。

- **確認**:
  マウスドラッグでカメラを回転させたり、ホイールでズームしたりできることを確認します。

## 6. ヒント

- **ヒント 1（インポートパス）**:
  OrbitControls は Three.js のコア（本体）には含まれておらず、アドオンとして提供されています。
  `import { OrbitControls } from 'three/examples/jsm/controls/OrbitControls';`
- **ヒント 2（初期化の引数）**:
  第一引数に「操作したいカメラ」、第二引数に「マウスイベントを受け取る DOM 要素」を渡します。
  `const controls = new OrbitControls(camera, renderer.domElement);`
- **ヒント 3（ダンピング）**:
  `controls.enableDamping = true;` を設定すると、マウスを離した後も少し滑るような慣性動作が加わり、高級感が出ます。
- **ヒント 4（Updateの必要性）**:
  ダンピングを有効にした場合、毎フレーム `controls.update()` を呼んで減衰計算を行う必要があります。
- **ヒント 5（カメラ操作の競合）**:
  OrbitControls を使うと、カメラの位置や向きはコントロールによって管理されます。
  アニメーションループ内で `camera.lookAt()` や `position` を手動で書き換えると、コントロールと競合してガタつくので注意してください。

## 7. スターターコード

```javascript
import * as THREE from "three";
// --- ここでOrbitControlsをインポート ---

// ...セットアップ...

// --- ここでControlsを作成 ---

function animate() {
  requestAnimationFrame(animate);

  // --- 必要ならupdate ---

  renderer.render(scene, camera);
}
animate();
```

## 8. 模範解答

```javascript
import * as THREE from "three";
import { OrbitControls } from "three/examples/jsm/controls/OrbitControls";

const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(
  75,
  window.innerWidth / window.innerHeight,
  0.1,
  1000
);
const renderer = new THREE.WebGLRenderer();
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

const geometry = new THREE.BoxGeometry(1, 1, 1);
const material = new THREE.MeshBasicMaterial({ color: 0x00ff00 });
const cube = new THREE.Mesh(geometry, material);
scene.add(cube);

camera.position.z = 5;

// OrbitControlsの作成
const controls = new OrbitControls(camera, renderer.domElement);
controls.enableDamping = true; // 慣性を有効にする

function animate() {
  requestAnimationFrame(animate);

  cube.rotation.x += 0.01;
  cube.rotation.y += 0.01;

  // コントロールの更新
  controls.update();

  renderer.render(scene, camera);
}

animate();
```
