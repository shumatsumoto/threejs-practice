## 1. 問題タイトル

68 本目：アウトライン効果（OutlinePass）

## 2. 学習目標

この演習を通じて、以下の技術を習得します。

- `OutlinePass` の使用方法
- 特定のオブジェクトの選択と強調表示
- エッジの色や太さのカスタマイズ

## 3. 新しい概念の解説

**Outline Pass（アウトラインパス）**
特定のオブジェクトの「輪郭線」を描画するポストプロセスです。
法線や深度情報を使ってエッジ（境界）を検出し、その部分にラインを引きます。
インタラクティブなアプリケーションで「現在選択中のアイテム」をユーザーに伝えるためのフィードバックとして非常に重要です。

```javascript
import { OutlinePass } from 'three/examples/jsm/postprocessing/OutlinePass';

const outlinePass = new OutlinePass(
  new THREE.Vector2(window.innerWidth, window.innerHeight),
  scene,
  camera
);

// アウトラインを表示したいオブジェクトの配列
outlinePass.selectedObjects = [ mesh ];

outlinePass.edgeStrength = 3.0; // 線の太さ
outlinePass.visibleEdgeColor.set('#ffffff'); // 線の色
composer.addPass(outlinePass);
```

## 4. 課題の説明

シーン内の特定のオブジェクト（例えばマウスオーバーした物体）の周囲に、光る輪郭線（アウトライン）を表示してください。
ゲームでのアイテム選択や、重要オブジェクトの強調に使われます。

## 5. 必須要件

以下の機能を実装してください。

- **シーン準備**:
  2つの異なる物体（MeshA, MeshB）を離して配置します。

- **OutlinePass 設定**:
  `OutlinePass(resolution, scene, camera)` を初期化してComposerに追加します。
  `outlinePass.selectedObjects` 配列に `[MeshA]` だけを追加します。

- **スタイル調整**:
  以下のプロパティを設定して見た目を整えます。
  - `edgeStrength`: 3.0（線の太さ）
  - `edgeGlow`: 0.0〜1.0（発光感）
  - `visibleEdgeColor`: `new THREE.Color('#ffffff')`

- **確認**:
  MeshA だけに白い輪郭線が表示され、MeshB には表示されないことを確認します。

## 6. ヒント

- **ヒント 1（必要なクラスのインポート）**:
  `OutlinePass` を使用します。
  `three/examples/jsm/postprocessing/OutlinePass`
- **ヒント 2（パスの初期化）**:
  `new OutlinePass(new THREE.Vector2(width, height), scene, camera)`
  第 2 引数にシーン、第 3 引数にカメラが必要です（深度情報や法線を計算して輪郭を特定するため）。
- **ヒント 3（対象オブジェクトの指定）**:
  `outlinePass.selectedObjects` プロパティに **配列** としてメッシュを渡します。
  `[ mesh1, mesh2 ]` のように複数指定可能です。空配列にするとアウトラインは消えます。
- **ヒント 4（色のカスタマイズ）**:
  `visibleEdgeColor`（見えている部分）と `hiddenEdgeColor`（手前の物体に隠れている部分）の色を個別に設定できます。
  `outlinePass.visibleEdgeColor.set('#ff0000');`
- **ヒント 5（太さと発光）**:
  `edgeStrength` で線の太さ、`edgeGlow` でぼんやりとした発光感を調整できます。
  `edgeThickness` は内部的な描画線の太さですが、通常はあまり変更しません。

## 7. スターターコード

```javascript
import * as THREE from "three";
import { EffectComposer } from "three/examples/jsm/postprocessing/EffectComposer";
import { RenderPass } from "three/examples/jsm/postprocessing/RenderPass";
// import { OutlinePass } ...

const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(
  75,
  window.innerWidth / window.innerHeight,
  0.1,
  1000
);
const renderer = new THREE.WebGLRenderer();
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

const cube1 = new THREE.Mesh(
  new THREE.BoxGeometry(1, 1, 1),
  new THREE.MeshNormalMaterial()
);
cube1.position.x = -2;
scene.add(cube1);

const cube2 = new THREE.Mesh(
  new THREE.BoxGeometry(1, 1, 1),
  new THREE.MeshNormalMaterial()
);
cube2.position.x = 2;
scene.add(cube2);

// --- ComposerとOutlinePass ---

camera.position.z = 5;

function animate() {
  requestAnimationFrame(animate);
  // composer.render();
}
animate();
```

## 8. 模範解答

```javascript
import * as THREE from "three";
import { EffectComposer } from "three/examples/jsm/postprocessing/EffectComposer";
import { RenderPass } from "three/examples/jsm/postprocessing/RenderPass";
import { OutlinePass } from "three/examples/jsm/postprocessing/OutlinePass";

const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(
  75,
  window.innerWidth / window.innerHeight,
  0.1,
  1000
);
const renderer = new THREE.WebGLRenderer();
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

const cube1 = new THREE.Mesh(
  new THREE.BoxGeometry(1, 1, 1),
  new THREE.MeshNormalMaterial()
);
cube1.position.x = -2;
scene.add(cube1);

const cube2 = new THREE.Mesh(
  new THREE.BoxGeometry(1, 1, 1),
  new THREE.MeshNormalMaterial()
);
cube2.position.x = 2;
scene.add(cube2);

const composer = new EffectComposer(renderer);
composer.addPass(new RenderPass(scene, camera));

const outlinePass = new OutlinePass(
  new THREE.Vector2(window.innerWidth, window.innerHeight),
  scene,
  camera
);
composer.addPass(outlinePass);

// 左のキューブだけ選択
outlinePass.selectedObjects = [cube1];

// パラメータ調整
outlinePass.edgeStrength = 3.0; // 太さ
outlinePass.edgeGlow = 0.5; // 発光
outlinePass.visibleEdgeColor.set("#ffffff"); // 見えている線の色
outlinePass.hiddenEdgeColor.set("#190a05"); // 隠れている線の色

camera.position.z = 5;

function animate() {
  requestAnimationFrame(animate);

  cube1.rotation.x += 0.01;
  cube2.rotation.x += 0.01;

  composer.render();
}
animate();
```
