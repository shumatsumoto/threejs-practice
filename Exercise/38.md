## 1. 問題タイトル

38 本目：スカイボックスの実装

## 2. 学習目標

この演習を通じて、以下の技術を習得します。

- 巨大な立方体による背景表現（スカイボックス）
- `BackSide`（裏面描画）の設定
- 没入感のある環境作り

## 3. 新しい概念の解説

**Skybox（スカイボックス）**
ゲームや 3D 空間で、無限に広がる空や宇宙を表現するためのテクニックです。
非常に巨大な立方体（Box）を作成し、その「内側」に空の景色（6 枚の画像）を貼り付けます。
カメラはその箱の中にいるため、どこを見ても空が見えるという仕組みです。

```javascript
const loader = new THREE.TextureLoader();
// 6面分のマテリアルを作成（内側描画：BackSide）
const materials = [
  new THREE.MeshBasicMaterial({ map: loader.load('px.jpg'), side: THREE.BackSide }), // 右
  new THREE.MeshBasicMaterial({ map: loader.load('nx.jpg'), side: THREE.BackSide }), // 左
  new THREE.MeshBasicMaterial({ map: loader.load('py.jpg'), side: THREE.BackSide }), // 上
  new THREE.MeshBasicMaterial({ map: loader.load('ny.jpg'), side: THREE.BackSide }), // 下
  new THREE.MeshBasicMaterial({ map: loader.load('pz.jpg'), side: THREE.BackSide }), // 前
  new THREE.MeshBasicMaterial({ map: loader.load('nz.jpg'), side: THREE.BackSide })  // 後
];

// 巨大なボックスを作成
const skybox = new THREE.Mesh(new THREE.BoxGeometry(1000, 1000, 1000), materials);
scene.add(skybox);
```

## 4. 課題の説明

演習 31 の環境マップは「背景プロパティ」を使いましたが、今回は巨大なボックスの内側に空の絵を貼り付ける「スカイボックス」の手法で空を作成してください。
この方法だと、背景画像を個別のマテリアルとして制御できます。

## 5. 必須要件

以下の機能を実装してください。

- **ジオメトリ作成**:
  巨大なボックス `BoxGeometry(500, 500, 500)` を作成します。
  カメラの `far` クリップ範囲に収まるサイズにしてください。

- **マテリアル配列の作成**:
  6枚の空の画像（px, nx, py...）を読み込みます。
  各画像に対応する `MeshBasicMaterial` を作成し、`side: THREE.BackSide`（裏面描画）を設定します。
  これらを配列 `[right, left, top, bottom, front, back]` に格納します。

- **スカイボックスの配置**:
  作成したジオメトリとマテリアル配列を使ってメッシュを作成し、シーンに追加します。

- **確認**:
  カメラを回転させ、全方位が空で囲まれていること、継ぎ目が自然であることを確認します。

## 6. ヒント

- **ヒント 1（内側を描画）**:
  カメラはボックスの中にいます。通常 Three.js は「外側の面」しか描画しないため、そのままだと透明に見えます。
  マテリアル設定で `side: THREE.BackSide` を指定し、内側の面を描画させます。
- **ヒント 2（巨大なサイズ）**:
  ボックスのサイズは `1000` など十分に大きくします。
  ただし、カメラの `far` クリップ面（デフォルト 1000）より大きいと表示されないので注意してください。
- **ヒント 3（マテリアルの種類）**:
  空は影の影響を受けたくないので、`MeshBasicMaterial` を使います（発光しているようなイメージ）。
- **ヒント 4（テクスチャの継ぎ目）**:
  スカイボックス用の 6 枚画像（Cube Map 用画像）を使わないと、継ぎ目が合わずに変に見えます。専用の素材を使いましょう。
- **ヒント 5（配列マテリアル）**:
  `new THREE.Mesh(geometry, materialsArray)` の形式を使います。
  配列の順序は [right, left, top, bottom, front, back] です。ファイル名（px, nx, py...）と一致させましょう。

## 7. スターターコード

```javascript
import * as THREE from "three";

const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(
  75,
  window.innerWidth / window.innerHeight,
  0.1,
  1000
);
const renderer = new THREE.WebGLRenderer();
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

// --- ここでスカイボックスを作成 ---

camera.position.z = 5;

function animate() {
  requestAnimationFrame(animate);
  // カメラを回して確認
  camera.rotation.y += 0.002;
  renderer.render(scene, camera);
}
animate();
```

## 8. 模範解答

```javascript
import * as THREE from "three";

const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(
  75,
  window.innerWidth / window.innerHeight,
  0.1,
  1000
);
const renderer = new THREE.WebGLRenderer();
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

const loader = new THREE.TextureLoader();
const path = "https://threejs.org/examples/textures/cube/Bridge2/";
const urls = [
  "posx.jpg",
  "negx.jpg",
  "posy.jpg",
  "negy.jpg",
  "posz.jpg",
  "negz.jpg",
];

const materials = urls.map((url) => {
  return new THREE.MeshBasicMaterial({
    map: loader.load(path + url),
    side: THREE.BackSide, // 内側を描画
  });
});

const geometry = new THREE.BoxGeometry(500, 500, 500);
const skybox = new THREE.Mesh(geometry, materials);
scene.add(skybox);

camera.position.z = 5;

function animate() {
  requestAnimationFrame(animate);

  // カメラを回転させて全天球を確認
  camera.rotation.y += 0.002;

  renderer.render(scene, camera);
}
animate();
```
