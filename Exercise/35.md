## 1. 問題タイトル

35 本目：GLTF モデルの読み込み

## 2. 学習目標

この演習を通じて、以下の技術を習得します。

- `GLTFLoader` の使用方法
- 外部 3D モデル（.gltf / .glb）のインポート
- 非同期読み込みの処理フロー

## 3. 新しい概念の解説

**GLTF Format**
「3D の JPEG」とも呼ばれる、Web での利用に最適化された標準 3D ファイル形式です。
テクスチャやアニメーション、シーン構造などを 1 つのファイル（.glb）やフォルダ構成（.gltf）にまとめて管理できます。

**Asynchronous Loading（非同期読み込み）**
3D モデルのデータは大きいため、読み込みに時間がかかります。
`loader.load()` 関数は、読み込みが終わったタイミングで関数（コールバック）を実行する仕組みになっており、Web ページ全体をフリーズさせずに裏側でデータを準備できます。

```javascript
import { GLTFLoader } from 'three/examples/jsm/loaders/GLTFLoader';

const loader = new GLTFLoader();

loader.load(
  'path/to/model.glb',
  function (gltf) {
    // 読み込み完了時に実行される
    scene.add(gltf.scene);
  },
  undefined,
  function (error) {
    // エラー時に実行される
    console.error(error);
  }
);
```

## 4. 課題の説明

Blender などで作られた 3D モデル（GLTF 形式）を読み込んでシーンに表示してください。
Three.js では GLTF が推奨フォーマットです。
※練習用に Three.js 公式サンプルのモデル URL を使用してください。

## 5. 必須要件

以下の機能を実装してください。

- **ローダーのインポートと作成**:
  `GLTFLoader` を `three/addons/loaders/GLTFLoader.js` (または `examples/jsm/...`) からインポートし、インスタンス化します。

- **モデルの非同期読み込み**:
  `loader.load(url, callback)` メソッドを使用します。
  適当なサンプルモデル（Three.js公式の `DamagedHelmet.gltf` など）のURLを使用してください。

- **シーンへの追加**:
  コールバック関数 `function (gltf) { ... }` の中で、`gltf.scene` を `scene.add()` します。
  読み込み前にシーンに追加しようとしないよう注意してください。

- **調整**:
  モデルが大きすぎたり小さすぎたりする場合があるため、必要に応じて `gltf.scene.scale` や `position` を調整します。
  また、適切なライト（DirectionalLightなど）を配置してモデルが見えるようにします。

## 6. ヒント

- **ヒント 1（インポート）**:
  `import { GLTFLoader } from 'three/examples/jsm/loaders/GLTFLoader';`
  Three.js 本体（`three`）とは別の場所にあるアドオンなので、明示的なインポートが必要です。
- **ヒント 2（非同期処理）**:
  `loader.load()` の直後に `scene.add()` してもまだモデルは読み込まれていません。
  必ず 2 番目の引数であるコールバック関数 `(gltf) => { ... }` の中で追加処理を行ってください。
- **ヒント 3（シーンへの追加）**:
  読み込まれたデータの本体は `gltf.scene` に入っています。これを `scene.add(gltf.scene)` します。
- **ヒント 4（サイズ調整）**:
  外部モデルはスケールが大きすぎたり小さすぎたりすることがよくあります。
  画面に何も出ないときは `model.scale.set(10, 10, 10)` したり、カメラを引いてみてください。
- **ヒント 5（ライト）**:
  GLTF モデルの多くは `StandardMaterial` を使っています。ライトがないと真っ黒になるので、`AmbientLight` と `DirectionalLight` を強めに配置しましょう。

## 7. スターターコード

```javascript
import * as THREE from "three";
// --- ここでGLTFLoaderをインポート ---

const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(
  75,
  window.innerWidth / window.innerHeight,
  0.1,
  1000
);
const renderer = new THREE.WebGLRenderer();
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

const light = new THREE.DirectionalLight(0xffffff, 2);
light.position.set(2, 2, 2);
scene.add(light);

// --- ここでモデルを読み込んでください ---

camera.position.z = 5;

function animate() {
  requestAnimationFrame(animate);
  renderer.render(scene, camera);
}
animate();
```

## 8. 模範解答

```javascript
import * as THREE from "three";
import { GLTFLoader } from "three/examples/jsm/loaders/GLTFLoader";

const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(
  75,
  window.innerWidth / window.innerHeight,
  0.1,
  1000
);
const renderer = new THREE.WebGLRenderer();
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

// ライトがないと暗くて見えないことが多い
const ambientLight = new THREE.AmbientLight(0xffffff, 1);
scene.add(ambientLight);

const directionalLight = new THREE.DirectionalLight(0xffffff, 2);
directionalLight.position.set(5, 5, 5);
scene.add(directionalLight);

// GLTFLoaderの作成
const loader = new GLTFLoader();

// モデルのロード
loader.load(
  "https://threejs.org/examples/models/gltf/DamagedHelmet/glTF/DamagedHelmet.gltf",
  (gltf) => {
    // ロード完了時の処理
    const model = gltf.scene;

    // サイズ調整（モデルによっては巨大だったり極小だったりする）
    model.scale.set(1.5, 1.5, 1.5);

    scene.add(model);
  },
  undefined, // 進捗コールバック（省略可）
  (error) => {
    console.error("An error happened", error);
  }
);

camera.position.z = 5;

function animate() {
  requestAnimationFrame(animate);
  renderer.render(scene, camera);
}
animate();
```
