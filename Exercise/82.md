## 1. 問題タイトル

82 本目：3D 製品ビューアー（コンフィギュレーター）

## 2. 学習目標

この演習を通じて、以下の技術を習得します。

- オブジェクトの特定パーツの色変更
- UI（HTML ボタン）と 3D シーンの連携
- カメラのスムーズな移動（視点切り替え）

## 3. 新しい概念の解説

**Product Configurator（製品コンフィギュレーター）**
ユーザーが製品の色やパーツをカスタマイズできる Web アプリケーションのことです。
HTML のボタン（DOM 要素）と 3D シーンを連携させる典型的な例です。
カメラを特定の位置にスムーズに移動させることで、ユーザーの視線を誘導し、製品の魅力を効果的に伝えることができます。

```javascript
/*
  ボタンがクリックされたら
  1. マテリアルの色を変更
  2. カメラの目標位置（targetPos）を更新
*/
document.getElementById('redBtn').addEventListener('click', () => {
  mesh.material.color.set(0xff0000);
  targetPos.set(5, 5, 5);
});

function animate() {
  /*
    毎フレーム少しずつ目標位置に近づける（線形補間: Lerp）
    0.05 は移動速度（平滑化係数）
  */
  camera.position.lerp(targetPos, 0.05);
  renderer.render(scene, camera);
}
```

## 4. 課題の説明

EC サイトにあるような、製品（例えば椅子や車）のカラーバリエーションを確認できるビューアーを作成してください。
画面上の HTML ボタンをクリックすると、3D モデルの色が変わり、カメラがそのパーツを見やすい位置に移動します。

## 5. 必須要件

以下の機能を実装してください。

- **製品モデルの作成**:
  椅子のような形状を `new THREE.Group()` にまとめ、複数のパーツ（座面、背もたれ、脚）で構成します。
  色を変えたいパーツ（座面など）のマテリアルを変数に保持しておきます。

- **HTML UIの作成**:
  `document.createElement("button")` でボタンを複数作成し（赤、青、緑など）、画面上に絶対配置（`position: absolute`）します。
  各ボタンにはターゲットとなる「色（Hex）」と「カメラ位置（Vector3）」のデータを持たせます。

- **イベント処理**:
  ボタンクリック時に以下を実行します。
  1. マテリアルの色を `material.color.set(hex)` で変更。
  2. ターゲットとなるカメラ位置をグローバル変数（例：`targetPosition`）に保存（直接 `camera.position` に代入しない）。

- **カメラアニメーション**:
  `animate` ループ内で `camera.position.lerp(targetPosition, 0.05)` を実行し、滑らかに視点を移動させます。
  `OrbitControls` も併用し、ドラッグ操作も可能にします。

## 6. ヒント

- **ヒント 1（パーツ管理）**:
  椅子などは `Group` にまとめておくと便利ですが、色を変える際は個別のメッシュ（座面、背もたれ）のマテリアルにアクセスする必要があります。
  `chairGroup.children` を走査するか、変数を保持しておきましょう。
- **ヒント 2（カメラ移動のスムーズ化）**:
  いきなり `camera.position.copy(target)` すると瞬間移動してしまいます。
  `animate` ループ内で `camera.position.lerp(target, 0.05)` を使うと、毎フレーム 5% ずつ近づくため、滑らかなアニメーションになります。
- **ヒント 3（マテリアルの共有）**:
  座面と背もたれが同じ色なら、同じマテリアルインスタンスを共有しておけば、一箇所の変更で両方の色が変わります。
- **ヒント 4（UI連携）**:
  HTML ボタンは `document.createElement('button')` で作り、`position: absolute` でキャンバスの上に配置するのが手軽です。
- **ヒント 5（データ構造）**:
  ボタンの情報（ラベル、色コード、カメラ位置）をオブジェクトの配列として定義し、`forEach` でループしてボタン生成するとコードがスッキリします。

## 7. スターターコード

```javascript
import * as THREE from "three";
import { OrbitControls } from "three/examples/jsm/controls/OrbitControls";

const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(
  75,
  window.innerWidth / window.innerHeight,
  0.1,
  1000
);
const renderer = new THREE.WebGLRenderer();
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

const controls = new OrbitControls(camera, renderer.domElement);

// 製品モデル（椅子など）
const seat = new THREE.Mesh(
  new THREE.BoxGeometry(1, 0.1, 1),
  new THREE.MeshStandardMaterial({ color: 0xffffff })
);
scene.add(seat);

// HTMLボタン作成
const btn = document.createElement("button");
btn.innerText = "Red";
btn.style.position = "absolute";
btn.style.top = "10px";
btn.style.left = "10px";
document.body.appendChild(btn);

btn.addEventListener("click", () => {
  // --- 色変更とカメラ移動 ---
});

camera.position.set(2, 2, 2);

function animate() {
  requestAnimationFrame(animate);
  controls.update();
  renderer.render(scene, camera);
}
animate();
```

## 8. 模範解答

```javascript
import * as THREE from "three";
import { OrbitControls } from "three/examples/jsm/controls/OrbitControls";

const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(
  75,
  window.innerWidth / window.innerHeight,
  0.1,
  1000
);
const renderer = new THREE.WebGLRenderer({ antialias: true });
renderer.setSize(window.innerWidth, window.innerHeight);
renderer.setClearColor(0xf0f0f0);
document.body.appendChild(renderer.domElement);

const controls = new OrbitControls(camera, renderer.domElement);

const light = new THREE.DirectionalLight(0xffffff, 1);
light.position.set(5, 5, 5);
scene.add(light);
scene.add(new THREE.AmbientLight(0x404040));

// 椅子モデル
const chairGroup = new THREE.Group();

const seatMat = new THREE.MeshStandardMaterial({ color: 0x333333 });
const seat = new THREE.Mesh(new THREE.BoxGeometry(1, 0.1, 1), seatMat);
chairGroup.add(seat);

const backMat = new THREE.MeshStandardMaterial({ color: 0x333333 });
const back = new THREE.Mesh(new THREE.BoxGeometry(1, 1, 0.1), backMat);
back.position.set(0, 0.5, -0.45);
chairGroup.add(back);

const legGeo = new THREE.CylinderGeometry(0.05, 0.05, 1);
const legMat = new THREE.MeshStandardMaterial({ color: 0x888888 });
const leg1 = new THREE.Mesh(legGeo, legMat);
leg1.position.set(-0.4, -0.5, -0.4);
const leg2 = new THREE.Mesh(legGeo, legMat);
leg2.position.set(0.4, -0.5, -0.4);
const leg3 = new THREE.Mesh(legGeo, legMat);
leg3.position.set(-0.4, -0.5, 0.4);
const leg4 = new THREE.Mesh(legGeo, legMat);
leg4.position.set(0.4, -0.5, 0.4);
chairGroup.add(leg1, leg2, leg3, leg4);

scene.add(chairGroup);

// UI作成
const colors = [
  { name: "Red", hex: 0xff0000, cam: { x: 2, y: 2, z: 2 } },
  { name: "Blue", hex: 0x0000ff, cam: { x: -2, y: 1, z: 2 } },
  { name: "Green", hex: 0x00ff00, cam: { x: 0, y: 2, z: 3 } },
];

let targetCamPos = new THREE.Vector3(2, 2, 2);

colors.forEach((c, i) => {
  const btn = document.createElement("button");
  btn.innerText = c.name;
  btn.style.position = "absolute";
  btn.style.top = "10px";
  btn.style.left = 10 + i * 60 + "px";
  document.body.appendChild(btn);

  btn.addEventListener("click", () => {
    seatMat.color.setHex(c.hex);
    backMat.color.setHex(c.hex);
    targetCamPos.set(c.cam.x, c.cam.y, c.cam.z);
  });
});

camera.position.set(2, 2, 2);

function animate() {
  requestAnimationFrame(animate);

  // カメラをスムーズに移動
  camera.position.lerp(targetCamPos, 0.05);
  controls.update();

  renderer.render(scene, camera);
}
animate();
```
