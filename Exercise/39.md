## 1. 問題タイトル

39 本目：CanvasTexture（動的なテクスチャ）

## 2. 学習目標

この演習を通じて、以下の技術を習得します。

- HTML5 `Canvas` 要素を使ったテクスチャ生成
- `CanvasTexture` の使用方法
- 外部フォントファイルを読み込まずに文字を表示する手法

## 3. 新しい概念の解説

**CanvasTexture**
HTML5 の `<canvas>` 要素に描画した内容を、そのまま Three.js のテクスチャとして使う機能です。
画像を読み込む代わりに、プログラムで動的に絵や文字を描いてテクスチャ化できます。
日本語フォントの表示や、動的なグラフなどを 3D 空間に出すのに非常に便利です。

```javascript
// 1. Canvas作成
const canvas = document.createElement('canvas');
canvas.width = 256;
canvas.height = 256;
const ctx = canvas.getContext('2d');

// 2. 描画
ctx.fillStyle = 'white';
ctx.fillRect(0, 0, 256, 256);
ctx.fillStyle = 'black';
ctx.fillText('Hello', 100, 100);

// 3. テクスチャ化
const texture = new THREE.CanvasTexture(canvas);
const material = new THREE.MeshBasicMaterial({ map: texture });
```

## 4. 課題の説明

外部フォントファイルの読み込みはトラブルが起きやすいため、より手軽な方法として「Canvas に文字を描画し、それをテクスチャとして 3D オブジェクトに貼り付ける」手法を学びます。
"Hello Three.js" という文字が書かれたサイコロ（キューブ）を作成してください。

## 5. 必須要件

以下の機能を実装してください。

- **Canvasの作成**:
  JavaScript で `document.createElement('canvas')` を実行し、幅と高さ（例：256x256）を設定します。

- **描画処理**:
  `canvas.getContext('2d')` を取得し、`fillRect` で背景色を塗り、`fillText` で文字（"Hello"など）を描画します。

- **CanvasTextureの作成**:
  `new THREE.CanvasTexture(canvas)` を使用して、Canvas 要素からテクスチャを生成します。

- **3Dオブジェクトへの適用**:
  作成したテクスチャを `map` に設定したマテリアルを作り、キューブなどのメッシュに適用して表示します。

## 6. ヒント

- **ヒント 1（DOMへの追加不要）**:
  `document.createElement('canvas')` で作ったキャンバスは、メモリ上に存在していれば OK です。
  `body.appendChild` する必要はありません（デバッグ目的で画面に出すのはありです）。
- **ヒント 2（2D描画）**:
  `ctx.fillStyle`, `ctx.fillRect`, `ctx.fillText` など、標準的な HTML5 Canvas API がそのまま使えます。
- **ヒント 3（テクスチャ化）**:
  `const texture = new THREE.CanvasTexture(canvas)`
  これだけで Three.js のテクスチャオブジェクトに変換されます。
- **ヒント 4（解像度）**:
  キャンバスサイズ（width, height）がそのままテクスチャの解像度になります。
  文字がぼやける場合は `canvas.width = 512` など大きめに設定し、文字サイズも大きくしてください。
- **ヒント 5（文字位置）**:
  `ctx.textAlign = 'center'` と `ctx.textBaseline = 'middle'` を使うと、指定した座標を中心に文字を書けるので便利です。

## 7. スターターコード

```javascript
import * as THREE from "three";

const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(
  75,
  window.innerWidth / window.innerHeight,
  0.1,
  1000
);
const renderer = new THREE.WebGLRenderer();
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

// 1. Canvasの作成と描画
const canvas = document.createElement("canvas");
canvas.width = 256;
canvas.height = 256;
const ctx = canvas.getContext("2d");

// --- ここでCanvasに背景と文字を描画してください ---

// 2. テクスチャの作成
// const texture = new THREE.CanvasTexture(canvas);

// 3. マテリアルとメッシュの作成
// --- ここでキューブを作成してシーンに追加 ---

camera.position.z = 5;

function animate() {
  requestAnimationFrame(animate);
  renderer.render(scene, camera);
}
animate();
```

## 8. 模範解答

```javascript
import * as THREE from "three";

const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(
  75,
  window.innerWidth / window.innerHeight,
  0.1,
  1000
);
const renderer = new THREE.WebGLRenderer();
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

// 1. Canvasの作成
const canvas = document.createElement("canvas");
canvas.width = 512;
canvas.height = 512;
const ctx = canvas.getContext("2d");

// 2. Canvasへの描画
// 背景を白に
ctx.fillStyle = "#ffffff";
ctx.fillRect(0, 0, 512, 512);

// 文字を描画
ctx.font = "bold 60px Arial";
ctx.fillStyle = "#000000";
ctx.textAlign = "center";
ctx.textBaseline = "middle";
ctx.fillText("Hello Three.js", 256, 256);

// 枠線も描いてみる
ctx.strokeStyle = "#ff0000";
ctx.lineWidth = 20;
ctx.strokeRect(20, 20, 472, 472);

// 3. CanvasTextureの作成
const texture = new THREE.CanvasTexture(canvas);

// 4. キューブへの適用
const geometry = new THREE.BoxGeometry(2, 2, 2);
const material = new THREE.MeshBasicMaterial({ map: texture });
const cube = new THREE.Mesh(geometry, material);
scene.add(cube);

camera.position.z = 5;

function animate() {
  requestAnimationFrame(animate);

  cube.rotation.x += 0.01;
  cube.rotation.y += 0.01;

  renderer.render(scene, camera);
}
animate();
```
